---
import { getCollection, render } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import Post from '../components/Post.astro';

const posts = await getCollection('posts');
const sortedPosts = posts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const postsWithContent = await Promise.all(
  sortedPosts.map(async (post) => {
    const { Content } = await render(post);
    return { post, Content };
  })
);
---

<Layout currentPage="posts">
  {postsWithContent.map(({ post, Content }) => (
    <Post title={post.data.title} date={post.data.date} excerpt={post.data.excerpt}>
      <Content />
    </Post>
  ))}
</Layout>
